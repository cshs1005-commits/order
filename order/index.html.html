<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é»é¤ç³»çµ±ï¼ˆæ“æœ‰è€…æ¨¡å¼ï¼‰</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
    body.owner { background:#e8f5e9; }
    h1 { text-align:center; }
    table { width:100%; border-collapse: collapse; background:#fff; }
    th, td { border:1px solid #ccc; padding:8px; text-align:center; }
    th { background:#eee; }
    input, select { width:90%; padding:4px; }
    input:disabled { background:#f0f0f0; color:#888; }
    .btn { padding:6px 12px; cursor:pointer; margin:4px; }
    .btn-add { margin:10px 0; }
    .total { font-size:1.2em; text-align:right; margin-top:10px; }
    .mode-box { text-align:center; margin-bottom:12px; padding:10px; border-radius:8px; font-weight:bold; }
    .mode-customer { background:#ffecec; color:#b00000; }
    .mode-owner { background:#e0f2ff; color:#005999; }
    .login-box { text-align:center; margin-bottom:10px; }
  </style>
</head>
<body>

<h1>ğŸ” é»é¤ç³»çµ±</h1>

<!-- åº§è™Ÿ -->
<div style="text-align:center; margin-bottom:12px;">
  <label>åº§è™Ÿï¼š</label>
  <select id="seatSelect"></select>
</div>

<!-- æ“æœ‰è€…ç™»å…¥ -->
<div class="login-box" id="loginBox">
  <input type="password" id="passwordInput" placeholder="æ“æœ‰è€…å¯†ç¢¼" />
  <button class="btn" onclick="loginOwner()">ç™»å…¥æ“æœ‰è€…</button>
</div>

<div id="modeBox" class="mode-box mode-customer">
  <span id="modeText">ç›®å‰æ¨¡å¼ï¼šé¡§å®¢</span>
  <button id="logoutBtn" class="btn" style="display:none" onclick="logoutOwner()">ç™»å‡º</button>
</div>

<table id="menuTable">
  <thead>
    <tr>
      <th>é¤é»</th>
      <th>åƒ¹æ ¼</th>
      <th>æ•¸é‡</th>
      <th>å°è¨ˆ</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button class="btn btn-add" onclick="addRow()">â• æ–°å¢é¤é»</button>

<div class="total">ç¸½é‡‘é¡ï¼š<span id="totalPrice">0</span> å…ƒ</div>

<button class="btn" onclick="sendOrder()">ğŸ“¤ é€å‡ºè¨‚å–®</button>

<script>
  const OWNER_PASSWORD = '1';
  const GOOGLE_SHEET_WEBHOOK = 'https://script.google.com/macros/s/AKfycbyu85FHTfgQLmepEwS0N6hFnSVIQ49OfIOW3P7bT_i4j0OG1rN059xsF7RTjO8ZAx_k/exec';
  let isOwner = false;

  function initSeats() {
    const s = document.getElementById('seatSelect');
    s.innerHTML = '<option value="">è«‹é¸åº§è™Ÿ</option>';
    for (let i=1;i<=35;i++) {
      const o = document.createElement('option');
      o.value = i;
      o.textContent = i + ' è™Ÿ';
      s.appendChild(o);
    }
  }

  function loginOwner() {
    if (document.getElementById('passwordInput').value !== OWNER_PASSWORD) {
      alert('å¯†ç¢¼éŒ¯èª¤'); return;
    }
    isOwner = true;
    updateMode();
  }

  function logoutOwner() {
    isOwner = false;
    updateMode();
  }

  function updateMode() {
    document.body.classList.toggle('owner', isOwner);
    document.getElementById('loginBox').style.display = isOwner ? 'none' : 'block';
    document.getElementById('logoutBtn').style.display = isOwner ? 'inline-block' : 'none';
    document.getElementById('modeText').innerText = isOwner ? 'ç›®å‰æ¨¡å¼ï¼šæ“æœ‰è€…' : 'ç›®å‰æ¨¡å¼ï¼šé¡§å®¢';

    document.querySelectorAll('#menuTable tbody tr').forEach(r => {
      r.children[0].querySelector('input').disabled = !isOwner;
      r.children[1].querySelector('input').disabled = !isOwner;
      r.querySelector('button').style.display = isOwner ? 'inline-block' : 'none';
    });
    document.querySelector('.btn-add').style.display = isOwner ? 'inline-block' : 'none';
  }

  function addRow(force = false) {
    if (!isOwner && !force) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" value="é¤é»"></td>
      <td><input type="number" value="0"></td>
      <td><input type="number" value="0" min="0"></td>
      <td class="subtotal">0</td>
      <td><button class="btn" onclick="this.closest('tr').remove();updateTotal();">åˆªé™¤</button></td>`;
    document.querySelector('#menuTable tbody').appendChild(tr);
    updateMode();
  }

  function updateTotal() {
    let total = 0;
    document.querySelectorAll('#menuTable tbody tr').forEach(r => {
      const price = +r.children[1].querySelector('input').value || 0;
      const qty = +r.children[2].querySelector('input').value || 0;
      const sub = price * qty;
      r.querySelector('.subtotal').innerText = sub;
      total += sub;
    });
    document.getElementById('totalPrice').innerText = total;
  }

  function sendOrder() {
    const seat = document.getElementById('seatSelect').value;
    if (!seat) { alert('è«‹é¸åº§è™Ÿ'); return; }

    const items = [];
    document.querySelectorAll('#menuTable tbody tr').forEach(r => {
      const name = r.children[0].querySelector('input').value;
      const price = +r.children[1].querySelector('input').value || 0;
      const qty = +r.children[2].querySelector('input').value || 0;
      if (qty>0) items.push({name, price, qty, subtotal: price*qty});
    });
    if (!items.length) { alert('å°šæœªé»é¤'); return; }

    const data = {
      seatNo: seat,
      orderNo: 'OD' + Date.now(),
      time: new Date().toLocaleString(),
      total: document.getElementById('totalPrice').innerText,
      items
    };

    fetch(GOOGLE_SHEET_WEBHOOK, {
      method: 'POST',
      mode: 'no-cors', // â­ é¿å…ç€è¦½å™¨é˜»æ“‹ï¼ˆGAS å¿…å‚™ï¼‰
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    }).then(()=>{
      alert('è¨‚å–®é€å‡ºå®Œæˆ');
    }).catch(()=>{
      alert('é€å‡ºå¤±æ•—ï¼Œè«‹ç¢ºèª App Script');
    });
  }

  document.addEventListener('input', updateTotal);
  initSeats();
  addRow(true);
  updateMode();
</script>

</body>
</html>
